(function(a,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(a=typeof globalThis<"u"?globalThis:a||self,e(a.index=a.index||{},a.Vue))})(this,function(a,e){"use strict";const T={data:{type:Array,default:()=>[]},estimatedItemSize:{type:Number,required:!0},bufferScale:{type:Number,default:1},height:{type:String,default:"100%"},autoScroll:{type:Boolean,default:!1},scrollRow:{type:Number,default:1},scrollDistance:{type:Number},scrollInterval:{type:Number,default:100},stopTime:{type:Number,default:1e4}},x=["id"],h=e.defineComponent({__name:"index",props:T,setup(m){const i=m,n=e.ref(null),S=e.ref(null),y=e.ref(null),d=e.ref(null),t=e.reactive({positions:[],screenHeight:0,start:0,end:0,isMouseHover:!1,intervalID:null});e.onBeforeMount(()=>{I()}),e.onMounted(()=>{t.screenHeight=n.value.clientHeight,t.start=0,t.end=t.start+v.value,_(),V()}),e.onUpdated(()=>{e.nextTick(()=>{var o,s;if(!d.value||!((o=d.value)!=null&&o.length))return;z();let l=(s=t.positions.at(-1))==null?void 0:s.bottom;S.value.style.height=`${l}px`,L()})}),e.onBeforeUnmount(()=>{b()}),e.watch(()=>i.data,()=>{I()});const I=()=>{t.positions=i.data.map((l,o)=>({index:o,height:i.estimatedItemSize,top:o*i.estimatedItemSize,bottom:(o+1)*i.estimatedItemSize}))},H=(l=0)=>M(t.positions,l),M=(l,o)=>{let s=0,u=l.length-1,r=null;for(;s<=u;){let f=parseInt((s+u)/2+""),c=l[f].bottom;if(c===o)return f+1;c<o?s=f+1:c>o&&((r===null||r>f)&&(r=f),u=u-1)}return r},k=e.computed(()=>i.data.map((l,o)=>({_index_:o,...l}))),v=e.computed(()=>Math.ceil(t.screenHeight/i.estimatedItemSize)),g=e.computed(()=>Math.min(t.start,i.bufferScale*v.value)),B=e.computed(()=>Math.min(i.data.length-t.end,i.bufferScale*v.value)),E=e.computed(()=>{let l=t.start-g.value,o=t.end+B.value;return k.value.slice(l,o)}),L=()=>{let l=0;if(t.start>=1){let o=t.positions[t.start].top-(t.positions[t.start-g.value]?t.positions[t.start-g.value].top:0);l=t.positions[t.start-1].bottom-o}else l=0;y.value.style.transform=`translate3d(0,${l}px,0)`},z=()=>{if(d.value)for(let l=0;l<d.value.length;l++){let o=d.value[l],u=o.getBoundingClientRect().height,r=+o.id,c=t.positions[r].height-u;if(c){t.positions[r].bottom=t.positions[r].bottom-c,t.positions[r].height=u;for(let p=r+1;p<t.positions.length;p++)t.positions[p].top=t.positions[p-1].bottom,t.positions[p].bottom=t.positions[p].bottom-c}}},N=()=>{let l=n.value.scrollTop;t.start=H(l),t.end=t.start+v.value,L()},_=()=>{t.intervalID===null&&i.autoScroll&&!t.isMouseHover&&(t.intervalID=setInterval(()=>{if(n.value){let l=0;if(i.scrollDistance&&(l=i.scrollDistance),i.scrollRow&&l===0){let o=0;for(let s=0;s<i.scrollRow;s++)o+=t.positions[t.start+s].height;l=o}if(Math.abs(n.value.scrollHeight-n.value.clientHeight-n.value.scrollTop)>=1){let o=n.value.scrollTop+l;n.value.scrollTo({top:o,behavior:"smooth"})}else b(),setTimeout(()=>{n.value.scrollTo({top:0,behavior:"instant"}),setTimeout(()=>{_()},500)},i.stopTime)}},i.scrollInterval))},b=()=>{t.intervalID&&(clearInterval(t.intervalID),t.intervalID=null)},V=()=>{n.value&&(n.value.addEventListener("mouseenter",()=>{b(),t.isMouseHover=!0}),n.value.addEventListener("mouseleave",()=>{t.isMouseHover=!1,_()}))};return(l,o)=>(e.openBlock(),e.createElementBlock("div",{class:"f-virtual-list",ref_key:"virtualList",ref:n,style:e.normalizeStyle({height:l.height}),onScroll:o[0]||(o[0]=s=>N())},[e.createElementVNode("div",{class:"f-virtual-list__space",ref_key:"virtualList__space",ref:S},null,512),e.createElementVNode("div",{class:"f-virtual-list__content",ref_key:"virtualList__content",ref:y},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(E),s=>(e.openBlock(),e.createElementBlock("div",{class:"f-virtual-list__item",ref_for:!0,ref_key:"virtualList__item",ref:d,id:`${s._index_}`},[e.renderSlot(l.$slots,"default",{ref_for:!0,ref:"slot",params:{row:s,$index:s._index_}})],8,x))),256))],512)],36))}});h.install=function(m){m.component("FVirtualList",h)};const D={title:"virtualList 虚拟列表",name:"virtualList",category:"数据展示",status:"100%",install(m){m.use(h)}};a.VirtualList=h,a.default=D,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
