(function(_,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(_=typeof globalThis<"u"?globalThis:_||self,e(_.index=_.index||{},_.Vue))})(this,function(_,e){"use strict";const P=Object.assign,W=t=>Array.isArray(t)&&t||[],x=(t,o=new WeakMap)=>{if(t===null)return t;if(t instanceof Date)return new Date(t);if(t instanceof RegExp)return new RegExp(t);if(typeof t!="object")return t;if(o.get(t))return o.get(t);let r=new t.constructor;o.set(t,r);for(let l in t)t.hasOwnProperty(l)&&(r[l]=x(t[l],o));return r},G=(t,o)=>{const r=Math.abs(t[0]-o[0]),l=Math.abs(t[1]-o[1]);return Math.sqrt(r*r+l*l)};function J(t,o){const r=window.MutationObserver,l=new r(o);return l.observe(t,{attributes:!0,attributeFilter:["style"],attributeOldValue:!0}),l}var H;const U=typeof window<"u",Z=t=>typeof t=="string",L=()=>{};U&&((H=window==null?void 0:window.navigator)!=null&&H.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function M(t){return typeof t=="function"?t():e.unref(t)}function j(t,o){function r(...l){return new Promise((u,c)=>{Promise.resolve(t(()=>o.apply(this,l),{fn:o,thisArg:this,args:l})).then(u).catch(c)})}return r}function v(t,o={}){let r,l,u=L;const c=m=>{clearTimeout(m),u(),u=L};return m=>{const y=M(t),s=M(o.maxWait);return r&&c(r),y<=0||s!==void 0&&s<=0?(l&&(c(l),l=null),Promise.resolve(m())):new Promise((a,h)=>{u=o.rejectOnCancel?h:a,s&&!l&&(l=setTimeout(()=>{r&&c(r),l=null,a(m())},s)),r=setTimeout(()=>{l&&c(l),l=null,a(m())},y)})}}function ee(t){return t}function te(t){return e.getCurrentScope()?(e.onScopeDispose(t),!0):!1}function ne(t,o=200,r={}){return j(v(o,r),t)}function oe(t){var o;const r=M(t);return(o=r==null?void 0:r.$el)!=null?o:r}const re=U?window:void 0;function le(...t){let o,r,l,u;if(Z(t[0])||Array.isArray(t[0])?([r,l,u]=t,o=re):[o,r,l,u]=t,!o)return L;Array.isArray(r)||(r=[r]),Array.isArray(l)||(l=[l]);const c=[],w=()=>{c.forEach(a=>a()),c.length=0},m=(a,h,k)=>(a.addEventListener(h,k,u),()=>a.removeEventListener(h,k,u)),y=e.watch(()=>oe(o),a=>{w(),a&&c.push(...r.flatMap(h=>l.map(k=>m(a,h,k))))},{immediate:!0,flush:"post"}),s=()=>{y(),w()};return te(s),s}const A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},R="__vueuse_ssr_handlers__";A[R]=A[R]||{},A[R];var q;(function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT",t.NONE="NONE"})(q||(q={}));var ie=Object.defineProperty,K=Object.getOwnPropertySymbols,ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable,X=(t,o,r)=>o in t?ie(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,ce=(t,o)=>{for(var r in o||(o={}))ae.call(o,r)&&X(t,r,o[r]);if(K)for(var r of K(o))se.call(o,r)&&X(t,r,o[r]);return t};ce({linear:ee},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});const de=(t,o,r,l)=>{const u=e.ref(0),c=e.ref(0),w=e.ref(0),m=e.ref(0);let y,s=null,a=null;const h=(I=!0)=>new Promise(Q=>{e.nextTick(()=>{a=t.value,u.value=t.value?t.value.clientWidth:0,c.value=t.value?t.value.clientHeight:0,w.value=a?a.getBoundingClientRect().width:0,m.value=a?a.getBoundingClientRect().height:0,t.value?(!u.value||!c.value)&&console.warn("Component width or height is 0px"):console.warn("Failed to get dom node"),typeof o=="function"&&I&&o(),Q(!0)})}),k=()=>{s=J(a,y),le(window,"resize",y)},z=()=>{s&&(s.disconnect(),s.takeRecords(),s=null)},D=async()=>{await h(!1),y=ne(h,200),k(),typeof r=="function"&&r()};return e.onMounted(()=>{D()}),e.onUnmounted(()=>{z()}),{width:u,height:c,afterWidth:w,afterHeight:m,initWH:h}},ue={width:"100%",height:"100%"},fe=e.createStaticVNode('<defs><radialGradient id="lineGradient" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fff" stop-opacity="1"></stop><stop offset="100%" stop-color="#fff" stop-opacity="0"></stop></radialGradient><radialGradient id="haloGradient" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fff" stop-opacity="0"></stop><stop offset="100%" stop-color="#fff" stop-opacity="1"></stop></radialGradient></defs>',1),he=["id","cx","cy"],me=["values","dur"],pe=["dur"],ye=["id"],ke=["xlink:href"],ge=["xlink:href","fill","mask"],_e=["fill","x","y"],we=["href","width","height","x","y"],xe=["id","d"],Oe=["id"],Ee=["r"],$e=["dur","path"],Ce=["xlink:href","stroke-width","stroke"],be=["xlink:href","stroke-width","stroke","mask"],Be=["from","to","dur"],S=e.defineComponent({name:"index",props:{bgUrl:{type:String},points:{type:Array,default:()=>[]},paths:{type:Array,default:()=>[]},line:{type:Object,default:()=>({show:!0,type:"line",width:2,color:"#ffde93",orbitColor:"rgba(103, 224, 227, .2)",duration:700,radius:100,k:-.5,curvature:5})},halo:{type:Object,default:()=>({show:!0,duration:700,color:"#3891c2",radius:100})},title:{type:Object,default:()=>({show:!0,offest:[0,-10],color:"black",fontSize:16})},icon:{type:Object,default:()=>({show:!0,url:"",width:10,height:10})}},emits:["map-click"],setup(t){const o=t,r=e.ref();let l;e.onMounted(()=>{l=e.getCurrentInstance()});const u=e.reactive({halo:{show:!0,duration:700,color:"#3891c2",radius:100},title:{show:!0,offest:[0,-10],color:"black",fontSize:16},icon:{show:!0,url:"",width:10,height:10},line:{show:!0,type:"line",width:3,color:"#ffde93",orbitColor:"rgba(103, 224, 227, .2)",duration:700,radius:100,k:-.5,curvature:5}}),c=e.reactive({points:[],paths:[]}),w=i=>{let{offsetX:f,offsetY:n}=i;const g=(f/s.value).toFixed(2),d=(n/a.value).toFixed(2);l==null||l.emit("map-click",g,d,i)},m=()=>{h(),k()},y=()=>{h(),k()},{width:s,height:a}=de(r,m,y),h=()=>{let i=x(W(o.points));c.points=i.map((f,n)=>(console.log("icon",f.icon),{...f,halo:P({},u.halo,x(o.halo),f.halo),title:P({},u.title,x(o.title),f.title),icon:P({},u.icon,x(o.icon),f.icon),key:`${f.coordinate.toString()}${n}`})),console.log("points",c.points)},k=()=>{let i=x(W(o.paths));c.paths=i.map((f,n)=>{var T,O;let{source:g,route:d,target:B,line:V}=f,E=P({},u.line,x(o.line),V),$=(T=c.points.find(({name:p})=>p===g))==null?void 0:T.coordinate,C=(O=c.points.find(({name:p})=>p===B))==null?void 0:O.coordinate,F=d?[$,...d,C]:[$,C],N=[];for(let p=0;p<F.length-1;p++){let Pe=F[p],b=z(Pe,F[p+1],E.k,E.curvature);console.log("path",b);let Se=`M${b[0].toString()} Q${b[1].toString()} ${b[2].toString()}`,Ie=`${b.toString()}`;N.push({path:b,d:Se,key:Ie})}return{...f,line:E,routeList:N}}),console.log("state.paths",c.paths)},z=(i,f,n,g)=>{console.log("start",i);let[d,B]=i,[V,E]=f;const[$,C]=[(d+V)/2,(B+E)/2];let N=G([d,B],[V,E])/g,T=N/2,[O,p]=[$,C];do O+=T,p=D(n,[$,C],O)[1];while(G([$,C],[O,p])<N);return[i,[O,p],f]};function D(i,[f,n],g){const d=n-i*f+i*g;return[g,d]}let I=e.computed(()=>function(i){return`M${i[0][0]*s.value},${i[0][1]*a.value} 
    Q${i[1][0]*s.value},${i[1][1]*a.value} 
    ${i[2][0]*s.value},${i[2][1]*a.value}`}),Q=e.computed(()=>function(i){return`"M${i[0][0]*s.value},${i[0][1]*a.value} Q${i[1][0]*s.value},${i[1][1]*a.value} ${i[2][0]*s.value},${i[2][1]*a.value}"`}),Y=e.computed(()=>function(i){return l?l.proxy.$refs[i][0].getTotalLength():0});return e.watch(()=>o,i=>{h(),k()},{deep:!0,immediate:!0}),(i,f)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"flightChart",ref:r,class:"f-flight-chart"},[e.createElementVNode("div",{class:"f-flight-chart__wrap",style:e.normalizeStyle(`background-image: url(${o.bgUrl})`),onClick:w},[(e.openBlock(),e.createElementBlock("svg",ue,[fe,(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.points,(n,g)=>(e.openBlock(),e.createElementBlock("g",{key:n.key},[e.createElementVNode("defs",null,[n.halo.show?(e.openBlock(),e.createElementBlock("circle",{key:0,id:`halo${n.key}`,cx:n.coordinate[0]*e.unref(s),cy:n.coordinate[1]*e.unref(a)},[e.createElementVNode("animate",{attributeName:"r",values:`1;${n.halo.radius}`,dur:`${n.halo.duration}ms`,repeatCount:"indefinite"},null,8,me),e.createElementVNode("animate",{attributeName:"opacity",values:"1;0",dur:`${n.halo.duration}ms`,repeatCount:"indefinite"},null,8,pe)],8,he)):e.createCommentVNode("",!0),e.createElementVNode("mask",{id:`mask${n.key}`},[e.createElementVNode("use",{"xlink:href":`#halo${n.key}`,fill:"url(#haloGradient)"},null,8,ke)],8,ye)]),n.halo.show?(e.openBlock(),e.createElementBlock("use",{key:0,"xlink:href":`#halo${n.key}`,fill:n.halo.color,mask:`url(#mask${n.key})`},null,8,ge)):e.createCommentVNode("",!0),n.title.show?(e.openBlock(),e.createElementBlock("text",{key:1,class:"point__title",style:e.normalizeStyle({fontSize:`${n.title.fontSize}px`}),fill:n.title.color,x:n.coordinate[0]*e.unref(s)+n.title.offest[0],y:n.coordinate[1]*e.unref(a)+n.title.offest[1]},e.toDisplayString(n.name),13,_e)):e.createCommentVNode("",!0),n.icon.show?(e.openBlock(),e.createElementBlock("image",{key:2,class:"point__icon",href:n.icon.url,width:n.icon.width,height:n.icon.height,x:n.coordinate[0]*e.unref(s)-n.icon.width/2,y:n.coordinate[1]*e.unref(a)-n.icon.height/2},null,8,we)):e.createCommentVNode("",!0)]))),128)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.paths,(n,g)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.routeList,(d,B)=>(e.openBlock(),e.createElementBlock("g",null,[e.createElementVNode("defs",null,[e.createElementVNode("path",{id:d.key,ref_for:!0,ref:d.key,d:e.unref(I)(d.path),fill:"transparent"},null,8,xe),e.createElementVNode("mask",{id:`mask${d.key}`},[e.createElementVNode("circle",{cx:"0",cy:"0",r:n.line.radius,fill:"url(#lineGradient)"},[e.createElementVNode("animateMotion",{dur:`${n.line.duration}ms`,path:e.unref(I)(d.path),rotate:"auto",repeatCount:"indefinite"},null,8,$e)],8,Ee)],8,Oe)]),n.line.show&&n.line.slot?(e.openBlock(),e.createElementBlock("g",{key:0,class:"line__inner",style:e.normalizeStyle({"offset-path":`path(${e.unref(Q)(d.path)})`})},[e.renderSlot(i.$slots,n.line.slot)],4)):e.createCommentVNode("",!0),n.line.show?(e.openBlock(),e.createElementBlock("use",{key:1,"xlink:href":`#${d.key}`,"stroke-width":n.line.width,stroke:n.line.orbitColor},null,8,Ce)):e.createCommentVNode("",!0),n.line.show?(e.openBlock(),e.createElementBlock("use",{key:2,"xlink:href":`#${d.key}`,"stroke-width":n.line.width,stroke:n.line.color,mask:`url(#mask${d.key})`},[e.createElementVNode("animate",{attributeName:"stroke-dasharray",from:`0, ${e.unref(Y)(d.key)}`,to:`${e.unref(Y)(d.key)}, 0`,dur:`${n.line.duration}ms`,repeatCount:"indefinite"},null,8,Be)],8,be)):e.createCommentVNode("",!0)]))),256))],64))),256))]))],4)],512))}}),Fe="";S.install=function(t){t.component("FFlightChart",S)};const Ne={title:"FFlightChart 飞线图",category:"飞线图",status:"20%",install(t){t.use(S)}};_.FlightChart=S,_.default=Ne,Object.defineProperties(_,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
